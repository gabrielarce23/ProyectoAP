{"version":3,"sources":["../../src/providers/firebase-messaging.ts","../../node_modules/@angular/core/esm5 lazy","../../src lazy","../../src/pages/home/home.ts","../../src/app/main.ts","../../src/app/app.module.ts","../../src/app/app.component.ts","../../src/enviroment.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport { FirebaseApp } from 'angularfire2';\r\n// I am importing simple ionic storage (local one), in prod this should be remote storage of some sort.\r\nimport { Storage } from '@ionic/storage';\r\n\r\n@Injectable()\r\nexport class FirebaseMessagingProvider {\r\n  private messaging;\r\n  private unsubscribeOnTokenRefresh = () => {};\r\n  public token: string\r\n\r\n  constructor(\r\n    private storage: Storage,\r\n    private app: FirebaseApp\r\n  ) {\r\n    this.messaging = app.messaging();\r\n    navigator.serviceWorker.register('service-worker.js').then((registration) => {\r\n    this.messaging.useServiceWorker(registration);\r\n    //this.disableNotifications()\r\n    this.enableNotifications();\r\n});\r\n  }\r\n\r\n  public enableNotifications() {\r\n    console.log('Requesting permission...');\r\n    return this.messaging.requestPermission().then(() => {\r\n        console.log('Permission granted');\r\n        // token might change - we need to listen for changes to it and update it\r\n        this.setupOnTokenRefresh();\r\n        return this.updateToken();\r\n      })\r\n      .catch((err)=>console.log(err))\r\n      ;\r\n  }\r\n\r\n  public disableNotifications() {\r\n    this.unsubscribeOnTokenRefresh();\r\n    this.unsubscribeOnTokenRefresh = () => {};\r\n    return this.storage.set('fcmToken','').then();\r\n  }\r\n\r\n  private updateToken() {\r\n    return this.messaging.getToken().then((currentToken) => {\r\n      if (currentToken) {\r\n        // we've got the token from Firebase, now let's store it in the database\r\n        console.log(currentToken)\r\n        this.token = currentToken\r\n        return this.storage.set('fcmToken', currentToken);\r\n      } else {\r\n        console.log('No Instance ID token available. Request permission to generate one.');\r\n      }\r\n    });\r\n  }\r\n\r\n  private setupOnTokenRefresh(): void {\r\n    this.unsubscribeOnTokenRefresh = this.messaging.onTokenRefresh(() => {\r\n      console.log(\"Token refreshed\");\r\n      this.storage.set('fcmToken','').then(() => { this.updateToken(); });\r\n    });\r\n  }\r\n    \r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/providers/firebase-messaging.ts","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncatched exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 112;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/@angular/core/esm5 lazy\n// module id = 112\n// module chunks = 0","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncatched exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 153;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src lazy\n// module id = 153\n// module chunks = 0","import { FirebaseMessagingProvider } from './../../providers/firebase-messaging';\r\nimport { Component } from '@angular/core';\r\nimport { NavController, AlertController, Platform } from 'ionic-angular';\r\n\r\n@Component({\r\n  selector: 'page-home',\r\n  templateUrl: 'home.html'\r\n})\r\nexport class HomePage {\r\n  \r\n  constructor(public navCtrl: NavController, private alertCtrk: AlertController, private platform: Platform, private fmp:FirebaseMessagingProvider) {\r\n\r\n  }\r\n\r\n  showPlatform(){\r\n    let text = '' + this.platform.platforms();\r\n    let alert= this.alertCtrk.create({\r\n      title: 'My home',\r\n      subTitle: text,\r\n      buttons: ['OK']\r\n    })\r\n    alert.present()\r\n\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts","import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app.module';\r\n\r\nplatformBrowserDynamic().bootstrapModule(AppModule);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/main.ts","import { BrowserModule } from '@angular/platform-browser';\r\nimport { ErrorHandler, NgModule } from '@angular/core';\r\nimport { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';\r\nimport { SplashScreen } from '@ionic-native/splash-screen';\r\nimport { StatusBar } from '@ionic-native/status-bar';\r\n\r\nimport { MyApp } from './app.component';\r\nimport { HomePage } from '../pages/home/home';\r\n\r\nimport { AngularFireModule } from 'angularfire2';\r\nimport 'firebase/messaging'; // only import firebase messaging or as needed;\r\nimport { firebaseConfig } from '../enviroment'\r\nimport { FirebaseMessagingProvider } from '../providers/firebase-messaging';\r\nimport { IonicStorageModule } from '@ionic/storage';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    MyApp,\r\n    HomePage\r\n  ],\r\n  imports: [\r\n    BrowserModule,\r\n    IonicModule.forRoot(MyApp),\r\n    AngularFireModule.initializeApp(firebaseConfig),\r\n    IonicStorageModule.forRoot()\r\n  ],\r\n  bootstrap: [IonicApp],\r\n  entryComponents: [\r\n    MyApp,\r\n    HomePage\r\n  ],\r\n  providers: [\r\n    FirebaseMessagingProvider,\r\n    StatusBar,\r\n    SplashScreen,\r\n    {provide: ErrorHandler, useClass: IonicErrorHandler}\r\n  ]\r\n})\r\nexport class AppModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.module.ts","import { Component } from '@angular/core';\r\nimport { Platform } from 'ionic-angular';\r\nimport { StatusBar } from '@ionic-native/status-bar';\r\nimport { SplashScreen } from '@ionic-native/splash-screen';\r\n\r\nimport { HomePage } from '../pages/home/home';\r\nimport { FirebaseMessagingProvider } from '../providers/firebase-messaging';\r\n@Component({\r\n  templateUrl: 'app.html'\r\n})\r\nexport class MyApp {\r\n  rootPage:any = HomePage;\r\n\r\n  constructor(platform: Platform, statusBar: StatusBar, splashScreen: SplashScreen, fcmService: FirebaseMessagingProvider) {\r\n    platform.ready().then(() => {\r\n      // Okay, so the platform is ready and our plugins are available.\r\n      // Here you can do any higher level native things you might need.\r\n      statusBar.styleDefault();\r\n      splashScreen.hide();\r\n      \r\n    });\r\n  }\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.component.ts","export const firebaseConfig = {\r\n\r\n    apiKey: \"AIzaSyBEo-ORP_ExXnqyz9odQLzDmwsAIz7lQYU\",\r\n    authDomain: \"ceiapp-bae65.firebaseapp.com\",\r\n    databaseURL: \"https://ceiapp-bae65.firebaseio.com\",\r\n    projectId: \"ceiapp-bae65\",\r\n    storageBucket: \"ceiapp-bae65.appspot.com\",\r\n    messagingSenderId: \"248085553994\"\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/enviroment.ts"],"sourceRoot":""}